<project name="jsword" default="all">

	<!-- This build uses the core build targets -->
	<import file="../jsword/core.xml" />

	<!--=======================================================================-->
	<!-- target name="tools" depends="java2html,checkstyle,javancss,findbugs,pmd,cpd,jdepend"/ -->
	<target name="tools" depends="checkstyle,findbugs"/>

	<target name="findbugs" depends="build,findbugs.task">
		<mkdir dir="${findbugs.report}" />
		<findbugs home="${findbugs.home}" projectName="JSword/BibleDesktop" output="html" outputFile="${findbugs.report}/index.html" reportLevel="low" workHard="true" jvmargs="-Xmx512m">
			<class location="${target.jar}/jsword-${release.version}.jar" />
			<sourcePath>
				<dirset dir=".." includes="**/${source.java}" />
			</sourcePath>
			<auxClasspath>
				<fileset dir="${target.jar}" includes="*.jar" />
			</auxClasspath>
		</findbugs>
	</target>

	<target name="checkstyle" depends="checkstyle.task">
		<mkdir dir="${checkstyle.report}"/>
		<checkstyle config="${checkstyle.config}" failOnViolation="${checkstyle.fail}">
			<property key="checkstyle.basedir" file="${source.java}"/>
			<property key="checkstyle.cache.file" file="${target.root}/checkstyle.cache.dat"/>
			<fileset dir="${source.java}" includes="**/*.java" />
			<formatter type="plain"/>
			<formatter type="xml" toFile="${checkstyle.report}/checkstyle_errors.xml"/>
		</checkstyle>
		<xslt
	        in="${checkstyle.report}/checkstyle_errors.xml"
	        out="${checkstyle.report}/index.html"
	        style="${checkstyle.home}/contrib/checkstyle-simple.xsl">
			<xmlcatalog refid="commonDTDs"/>
		</xslt>
	</target>

	<target name="pmd" depends="pmd.task">
		<mkdir dir="${pmd.report}"/>

		<pmd rulesetfiles="${jsword.home}/JSword.pmd.ruleset.xml" shortFilenames="true">
			<formatter type="xml" toFile="${pmd.report}/report_pmd.xml"/>
			<fileset dir="${jsword.home}/${source.java}" includes="**/*.java"/>
		</pmd>
		<xslt in="${pmd.report}/report_pmd.xml"
	          style="${pmd.home}/etc/xslt/pmd-report-per-class.xslt"
	          out="${pmd.report}/index.html">
			<xmlcatalog refid="commonDTDs"/>
		</xslt>
		<xslt in="${pmd.report}/report_pmd.xml"
	          style="${pmd.home}/etc/xslt/corley-pmd-report.xslt"
	          out="${pmd.report}/index2.html">
			<xmlcatalog refid="commonDTDs"/>
		</xslt>
		<xslt in="${pmd.report}/report_pmd.xml"
	          style="${pmd.home}/etc/xslt/pmd-report.xslt"
	          out="${pmd.report}/index3.html">
			<xmlcatalog refid="commonDTDs"/>
		</xslt>
		<xslt in="${pmd.report}/report_pmd.xml"
	          style="${pmd.home}/etc/xslt/wz-pmd-report.xslt"
	          out="${pmd.report}/index4.html">
			<xmlcatalog refid="commonDTDs"/>
		</xslt>
		<copy file="${pmd.home}/etc/xslt/sorttable.js" overwrite="true"
	          tofile="${pmd.report}/sorttable.js"/>
	</target>

	<target name="jdepend">
		<echo>JDepend may fail if jdepend.jar is not visible to Ant.
	          To make it visible you need to do one of two things depending
	          on whether you are running ant in Eclipse or not.
	          In Eclipse, add jdepend-*.jar to Preferences -> Ant -> Runtime -> Global Entries
	          Otherwise, run the jdepend.antlibs task to copy jars to ANT_HOME/lib</echo>
		<mkdir dir="${jdepend.report}"/>
		<jdepend format="xml" outputfile="${jdepend.report}/jdepend-report.xml" fork="yes">
			<classespath>
				<path refid="path.allclasses"/>
			</classespath>
			<classpath>
				<fileset dir="${target.jar}" includes="**/*.jar"/>
				<fileset dir="${support.depend}" includes="**/*.jar"/>
			</classpath>
		</jdepend>
		<xslt
	        in="${jdepend.report}/jdepend-report.xml"
	        out="${jdepend.report}/jdepend-report.html"
	        style="${support.depend}/jdepend.xsl">
			<xmlcatalog refid="commonDTDs"/>
		</xslt>
	</target>

	<!--=======================================================================
    == Use the prepare.extra hook to get dependency jars.
    =========================================================================-->
	<target name="prepare.extra" depends="ivy.resolve" description="Prepare extras files.">
		<echo message="Done getting 3-rd Party dependencies." />
	</target>

	<!--=======================================================================
    == When we clean jsword, we also have to delete the keystore file.
    =========================================================================-->
	<target name="clean.extra" description="Extra stuff to do after calling clean">
		<delete dir="${keystore.file}" />
	</target>

</project>